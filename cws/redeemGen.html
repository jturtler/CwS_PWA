<!DOCTYPE html>
<html lang="en" class="bg-color">

  <head>
    <title>CwS - Provider: redeemGen</title>
    <script type="text/javascript" src="scripts/libraries/jquery-3.3.1.js"></script>
    <style>
        div.label {
            width:150px;
        }
        div.output { font-family: monospace; }
        input.button { width:120px;}
    </style>
  </head>
 
  <body>

    <table style="width:100%;height:100%">
        <tr>
            <td>
                
                <!-- INPUT  -->

                <table>

                    <tr>
                        <td>
                            <div class="label">user</div>
                        </td>
                        <td>
                            <input type="text" class="user" value="1004">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="label">status</div>
                        </td>
                        <td>
                            <select class="status">
                                <option value="random">mixed</option>
                                <option value="queued">queued</option>
                                <option value="submit">submit</option>
                                <option value="failed">failed</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="label">redeem url</div>
                        </td>
                        <td>
                            <input type="text" class="redeemURL" value="" >
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align:right">
                            <div class="label">rows</div>
                        </td>
                        <td>
                            <input type="text" class="rows" value="20">
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align:right">
                            <div class="label">minutes apart</div>
                        </td>
                        <td>
                            <input type="text" class="minSpread" value="30">
                        </td>
                    </tr>
                </table>

            </td>
        </tr>

        <tr>
            <td>
                <table>
                    <tr>
                        <td>
                            <div class="label"></div>
                        </td>
                        <td>
                            <input type="button" class="button" value="generate" onclick="generate()">
                        </td>
                    </tr>
                </table>
            </td>
        </tr>

        <tr>
            <td>
                
                <!-- OUTPUT  -->

                <!-- <div class="output" style="width:600px;height:100%;min-height:200px;border:1px solid #C0C0C0;overflow: scroll"></div>  -->
                <textarea class="output" style="min-width:50%;height:100%;min-height:200px;border:1px solid #C0C0C0;overflow: scroll"></textarea> 

            </td>
        </tr>

        <tr>
            <td>
                <table>
                    <tr>
                        <td>
                            <div style="text-align:right">localStorage</div>
                        </td>
                        <td>
                                <input type="button" class="button" value="Overwrite" onclick="writeToLocalStorage(true)">
                                <input type="button" class="button" value="Append" onclick="writeToLocalStorage(false)">
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>

    <script>

        $('input.redeemURL').css ( 'width',  $('textarea.output').css('width').replace('px','') - 90 );

        $('input.redeemURL').val ( location.origin + '/eRefWSDev3/api/dc/redeem')

        if ( localStorage.getItem ('session') )
        {
            $('input.user').val ( JSON.parse(localStorage.getItem ('session')).user )
        }

        http://localhost:8080/eRefWSDev3/api/dc/redeem
    
    function generate()
    {
        var myTemplate = template();
        var myDateTimeSeed = new Date();
        var myResult = '', tmpRow = '';

        for (var i = 1; i <= $('input.rows').val(); i++) 
        {
            myDateTimeSeed = getCalcTime(myDateTimeSeed,$('input.minSpread').val () * -1)
            var myDate = getTodayDate(myDateTimeSeed);
            var myTime = getTimeNow(myDateTimeSeed);
            var myUniqueItm = (new Date() ).toISOString();
    
            tmpRow = myTemplate;

            let newID = generateRandomString(8);
            let rnd8 = generateRandomNumber(8);
            let rnd12 = generateRandomNumber(12);
            let mystatus = ( ($('select.status').val() == 'random') ? getRandomWord('submit,queued,failed',myUniqueItm) : $('select.status').val() );

            tmpRow = tmpRow.replace( /{NEWID}/g, newID );
            tmpRow = tmpRow.replace( /{NUMERIC8}/g, generateRandomNumber(8) );
            tmpRow = tmpRow.replace( /{NUMERIC12}/g, rnd12 );
            tmpRow = tmpRow.replace( /{DATETODAY}/g, myDate );
            tmpRow = tmpRow.replace( /{TIMENOW}/g, myTime );
            tmpRow = tmpRow.replace( /{user}/g, $('input.user').val() );
            tmpRow = tmpRow.replace( /{status}/g, mystatus );
            tmpRow = tmpRow.replace( /{redeemURL}/g, $('input.redeemURL').val() );

            myResult += tmpRow + ',';

        }

        myResult = myResult.substring(myResult,myResult.length-1);

        $('textarea.output').val( (myResult) );

    }

    function getCalcTime(dtmSeed,min)
    {
        return new Date(dtmSeed.getTime() + (min*60000));
    }

    function template()
    {
        return '{  "title":"Voucher: {NUMERIC8} - {DATETODAY} {TIMENOW}.00", "created":"{DATETODAY} {TIMENOW}.00", "owner":"{user}", "id":"{NUMERIC12}", "status":"{status}", "network":false, ' +
             ' "data":{  "payloadJson":{  "countryType":"MZ", "cbdCase":"Y", "clientId":"", "voucherId":"", "cbdEnrollOuId":"", "walkInClientCase":"", "voucherCode":"{NUMERIC8}", "walkIn_birthDistrict":"MZ10", ' +
             ' "walkIn_birthOrder":"2", "walkIn_age":"28", "program":"FPL", "service":"COUNS", "typeOfMethodUser":"CONTINUE", "ownershipOfPhone":"NO", "addressCity":"Cape Town", "addressNeighborhood":"Somerset West", "pointOfReference":"A", "bookPageNumber":"2" ' +
             ' }, ' +
             ' "url":"{redeemURL}", ' +
             ' "actionJson":{   "actionType":"sendToWS", "payloadBody":["voucherCode" ], "payloadHeader":[  "usr","pwd" ], "alertResult":"true", "wsNACase":{  "note":"display message" },' +
             ' "redeemListInsert":"true", "url":"/api/dc/redeem" }}} '
    }

    function getTodayDate(dtmSeed)
    {
        var date = new Date(dtmSeed);
        var month = eval( date.getMonth() ) + 1;
        month = ( month < 10 ) ? "0" + month : month;
        var day = eval( date.getDate() );
        day = ( day < 10 ) ? "0" + day : day;
        return date.getFullYear() + "-" + month + "-" + day;
    }

    function getTimeNow(dtmSeed)
    {
        var d = new Date(dtmSeed),
            h = (d.getHours()<10?'0':'') + d.getHours(),
            m = (d.getMinutes()<10?'0':'') + d.getMinutes(),
            s = (d.getSeconds()<10?'0':'') + d.getSeconds();
        return (h+':'+m+':'+s);
    }

    function generateRandomNumberRange(min_value , max_value) 
    {
        return Math.random() * (max_value-min_value) + min_value ;
    }

    function getRandomWord(slist,anythingRandom)
    {
        var arrL = slist.split(',');
        var i = generateRandomNumberRange(0,arrL.length-1).toFixed(0);
        return arrL[i];
    }

    function generateRandomString(len) {
        var text = "";
        var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

        for (var i = 0; i < len; i++)
            text += possible.charAt(Math.floor(Math.random() * possible.length));

        return text;
    }

    function generateRandomNumber(len) {
        var text = "";
        var possible = "0123456789";

        for (var i = 0; i < len; i++)
            text += possible.charAt(Math.floor(Math.random() * possible.length));

        return text;
    }

    function writeToLocalStorage(overwrite)
    {
        if ( overwrite )
        {
            localStorage.setItem( 'redeemList', '{"list":[ ' +  $('textarea.output').val() + ' ] } ' );
        }
        else
        {
            var lsRed = JSON.parse( localStorage.getItem ('redeemList') ) ;

            if ( lsRed && lsRed.list )
            {
                var appList = JSON.parse( '[' + $('textarea.output').val() + ']' );
                var newList = lsRed.list.concat(appList);

                console.log( newList );
                console.log( JSON.stringify( newList ) );

                localStorage.setItem( 'redeemList', '{"list": ' + JSON.stringify( newList ) + ' } ' );
            }
            else
            {
                localStorage.setItem( 'redeemList', '{"list":[ ' +  $('textarea.output').val() + ' ] } ' );
            }

        }
        
    }
    
    </script>


    <style>
    #f1_container {
    position: relative;
    margin: 10px auto;
    width: 24px;
    height: 24px;
    z-index: 1;
    }
    #f1_container {
    perspective: 1000;
    }
    #f1_card {
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    transition: all 1.0s linear;
    }
    #f1_container:hover #f1_card {
    transform: rotateY(180deg);
    }
    .face {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    }
    .face.back {
    display: block;
    transform: rotateY(180deg);
    box-sizing: border-box;
    color: white;
    text-align: center;
    background-color: #fff;
    }
    </style>


    <div id="f1_container">
        <div id="f1_card" class="shadow">
            <div class="front face">
                <img src="img/net.svg"/>
            </div>
            <div class="back face center">
                    <img src="img/net-sync.svg"/>
            </div>
        </div>
    </div>

  </body>

</html>